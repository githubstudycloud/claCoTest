# GitLab v2 éƒ¨ç½²æ“ä½œè®°å½•

> **éƒ¨ç½²æ—¶é—´**: 2025-08-20  
> **éƒ¨ç½²æœåŠ¡å™¨**: 192.168.0.127  
> **GitLabç‰ˆæœ¬**: CE (Community Edition) Latest  
> **éƒ¨ç½²æ–¹å¼**: Docker Compose (ç®€åŒ–é…ç½®)

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

GitLab v2é‡‡ç”¨ç®€åŒ–çš„Docker Composeé…ç½®ï¼Œä¸“æ³¨äºå¿«é€Ÿéƒ¨ç½²å’Œä½å†…å­˜æ¶ˆè€—ï¼Œé€‚åˆå°å‹å›¢é˜Ÿæˆ–æµ‹è¯•ç¯å¢ƒä½¿ç”¨ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
~/gitlab-v2/
â”œâ”€â”€ docker-compose.yml       # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ manage.sh                # ç®¡ç†è„šæœ¬
â”œâ”€â”€ gitlab-config/           # GitLabé…ç½®ç›®å½•ï¼ˆå¤–æŒ‚ï¼‰
â”œâ”€â”€ gitlab-data/             # GitLabæ•°æ®ç›®å½•ï¼ˆå¤–æŒ‚ï¼‰
â””â”€â”€ gitlab-logs/             # GitLabæ—¥å¿—ç›®å½•ï¼ˆå¤–æŒ‚ï¼‰
```

## âš™ï¸ æ ¸å¿ƒé…ç½®

### Docker Composeé…ç½®

**å®¹å™¨è®¾ç½®**:
- **é•œåƒ**: gitlab/gitlab-ce:latest
- **å®¹å™¨å**: gitlab-v2
- **ä¸»æœºå**: gitlab-server
- **é‡å¯ç­–ç•¥**: unless-stopped

**ç«¯å£æ˜ å°„**:
- **HTTP**: 80:80 (Webç•Œé¢è®¿é—®)
- **SSH**: 2222:22 (Git SSHè®¿é—®)

**èµ„æºé™åˆ¶**:
```yaml
deploy:
  resources:
    limits:
      memory: 2G        # æœ€å¤§å†…å­˜2GB
      cpus: '2.0'       # æœ€å¤§2CPUæ ¸å¿ƒ
    reservations:
      memory: 1G        # é¢„ç•™å†…å­˜1GB
      cpus: '1.0'       # é¢„ç•™1CPUæ ¸å¿ƒ
```

### GitLabé…ç½®ä¼˜åŒ–

**æ€§èƒ½ä¼˜åŒ–é…ç½®**:
```yaml
# PostgreSQLæ•°æ®åº“ä¼˜åŒ–
postgresql['shared_buffers'] = '128MB'
postgresql['max_connections'] = 100
postgresql['work_mem'] = '8MB'

# Pumaåº”ç”¨æœåŠ¡å™¨ä¼˜åŒ–
puma['worker_processes'] = 2
puma['min_threads'] = 1
puma['max_threads'] = 2

# Sidekiqåå°ä»»åŠ¡ä¼˜åŒ–
sidekiq['max_concurrency'] = 5

# Nginx WebæœåŠ¡å™¨ä¼˜åŒ–
nginx['worker_processes'] = 1
nginx['worker_connections'] = 512
```

**ç¦ç”¨çš„æœåŠ¡** (èŠ‚çœå†…å­˜):
- Prometheusç›‘æ§
- Alertmanagerå‘Šè­¦ç®¡ç†
- Node/Redis/PostgreSQLå¯¼å‡ºå™¨
- Grafanaä»ªè¡¨ç›˜
- GitLab Pages
- Container Registry

## ğŸš€ éƒ¨ç½²è¿‡ç¨‹è®°å½•

### 1. ç¯å¢ƒå‡†å¤‡

**æœåŠ¡å™¨ä¿¡æ¯**:
- **IP**: 192.168.0.127
- **ç³»ç»Ÿ**: Ubuntu 24.04 LTS
- **ç”¨æˆ·**: ubuntu
- **Docker**: å·²å®‰è£…å¹¶è¿è¡Œ
- **Docker Compose**: v2 (å¯ç”¨)

### 2. ç›®å½•åˆ›å»º

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p ~/gitlab-v2
cd ~/gitlab-v2

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p gitlab-{config,logs,data}
```

### 3. é…ç½®æ–‡ä»¶éƒ¨ç½²

**docker-compose.yml** - ä¸»é…ç½®æ–‡ä»¶å·²éƒ¨ç½²
**manage.sh** - ç®¡ç†è„šæœ¬å·²åˆ›å»º

### 4. å®¹å™¨å¯åŠ¨è¿‡ç¨‹

**ç¬¬ä¸€æ¬¡å°è¯•** (å¤±è´¥):
```bash
docker compose up -d
# é”™è¯¯: SSHç«¯å£22å†²çª (ç³»ç»ŸSSHæœåŠ¡å ç”¨)
```

**ç«¯å£å†²çªè§£å†³**:
```yaml
# ä¿®æ”¹SSHç«¯å£æ˜ å°„
ports:
  - "80:80"
  - "2222:22"  # æ”¹ä¸º2222ç«¯å£

# æ›´æ–°GitLab SSHé…ç½®
gitlab_rails['gitlab_shell_ssh_port'] = 2222
```

**ç¬¬äºŒæ¬¡å¯åŠ¨** (æˆåŠŸ):
```bash
docker compose up -d
# ç»“æœ: Container gitlab-v2 Started
```

### 5. éƒ¨ç½²éªŒè¯

**å®¹å™¨çŠ¶æ€æ£€æŸ¥**:
```bash
docker compose ps
# NAME: gitlab-v2
# STATUS: Up (health: starting)
# PORTS: 0.0.0.0:80->80/tcp, 0.0.0.0:2222->22/tcp
```

**å¯åŠ¨æ—¥å¿—ç¡®è®¤**:
- GitLabæ­£åœ¨é…ç½®ä¸­ ("Configuring GitLab...")
- æœåŠ¡å¯åŠ¨æ­£å¸¸
- å¥åº·æ£€æŸ¥å¼€å§‹æ‰§è¡Œ

## ğŸ“Š å½“å‰çŠ¶æ€

### å®¹å™¨çŠ¶æ€ âœ…
- **çŠ¶æ€**: è¿è¡Œä¸­ (Up)
- **å¥åº·æ£€æŸ¥**: å¯åŠ¨ä¸­ (health: starting)
- **ç«¯å£ç»‘å®š**: æ­£å¸¸

### æœåŠ¡åˆå§‹åŒ– â³
- **é…ç½®é˜¶æ®µ**: è¿›è¡Œä¸­
- **é¢„è®¡å®Œæˆæ—¶é—´**: 10-15åˆ†é’Ÿ
- **é¦–æ¬¡è®¿é—®**: ç­‰å¾…åˆå§‹åŒ–å®Œæˆ

### èµ„æºä½¿ç”¨
- **å†…å­˜é™åˆ¶**: 2GB
- **CPUé™åˆ¶**: 2æ ¸å¿ƒ
- **å­˜å‚¨**: å¤–æŒ‚æŒä¹…åŒ–

## ğŸŒ è®¿é—®ä¿¡æ¯

### Webç•Œé¢è®¿é—®
- **URL**: http://192.168.0.127
- **ç”¨æˆ·å**: root
- **å¯†ç **: GitLabAdmin2024!

### SSH Gitè®¿é—®
- **SSHåœ°å€**: git@192.168.0.127:2222
- **å…‹éš†ç¤ºä¾‹**: `git clone ssh://git@192.168.0.127:2222/username/project.git`

### ç®¡ç†å‘½ä»¤
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/gitlab-v2

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f gitlab

# é‡å¯æœåŠ¡
docker compose restart

# åœæ­¢æœåŠ¡
docker compose down

# ä½¿ç”¨ç®¡ç†è„šæœ¬
./manage.sh status    # æŸ¥çœ‹çŠ¶æ€
./manage.sh logs      # æŸ¥çœ‹æ—¥å¿—
./manage.sh restart   # é‡å¯æœåŠ¡
```

## ğŸ“ äººå·¥æ“ä½œæ­¥éª¤

### å¿…é¡»å®Œæˆçš„æ“ä½œ

#### 1. ç­‰å¾…åˆå§‹åŒ–å®Œæˆ â³
**æ“ä½œ**: ç­‰å¾…10-15åˆ†é’Ÿè®©GitLabå®Œæˆé¦–æ¬¡åˆå§‹åŒ–
**éªŒè¯**: è®¿é—® http://192.168.0.127 èƒ½æ­£å¸¸æ˜¾ç¤ºç™»å½•é¡µé¢

#### 2. ä¿®æ”¹é»˜è®¤å¯†ç  ğŸ”’
**é‡è¦æ€§**: ğŸ”´ æé«˜ - å¿…é¡»æ“ä½œ
**æ­¥éª¤**:
1. ä½¿ç”¨ `root` / `GitLabAdmin2024!` ç™»å½•
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ Settings
3. å·¦ä¾§èœå•é€‰æ‹© Password
4. ä¿®æ”¹ä¸ºå¼ºå¯†ç 
5. ä¿å­˜æ›´æ”¹

#### 3. é…ç½®SSHå¯†é’¥ ğŸ”‘
**ç›®çš„**: å¯ç”¨SSH Gitæ“ä½œ
**æ­¥éª¤**:
1. ç”ŸæˆSSHå¯†é’¥ (å¦‚æœæ²¡æœ‰):
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your.email@example.com"
   ```
2. å¤åˆ¶å…¬é’¥: `cat ~/.ssh/id_rsa.pub`
3. GitLabä¸­æ·»åŠ : Settings â†’ SSH Keys â†’ Add key
4. æµ‹è¯•è¿æ¥: `ssh -T git@192.168.0.127 -p 2222`

#### 4. åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›® ğŸ“
**æ­¥éª¤**:
1. ç‚¹å‡» "New project"
2. é€‰æ‹© "Create blank project"
3. å¡«å†™é¡¹ç›®åç§°å’Œæè¿°
4. è®¾ç½®å¯è§æ€§çº§åˆ«
5. åˆ›å»ºé¡¹ç›®

### å¯é€‰æ“ä½œ

#### 1. é…ç½®å¼€æœºè‡ªå¯åŠ¨
ç”±äºä½¿ç”¨äº†ç”¨æˆ·ç›®å½•éƒ¨ç½²ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®å¼€æœºå¯åŠ¨:
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å¼€æœºå¯åŠ¨ä»»åŠ¡
@reboot cd /home/ubuntu/gitlab-v2 && docker compose up -d
```

#### 2. é…ç½®é‚®ä»¶æœåŠ¡
ç¼–è¾‘ `docker-compose.yml` æ·»åŠ SMTPé…ç½®:
```yaml
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
# ... å…¶ä»–SMTPé…ç½®
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
**ç—‡çŠ¶**: "bind: address already in use"
**è§£å†³**: ä¿®æ”¹ç«¯å£æ˜ å°„ï¼Œé¿å…ä¸ç³»ç»ŸæœåŠ¡å†²çª

#### 2. å†…å­˜ä¸è¶³
**ç—‡çŠ¶**: å®¹å™¨é¢‘ç¹é‡å¯
**è§£å†³**: 
- æ£€æŸ¥ç³»ç»Ÿå†…å­˜: `free -h`
- è°ƒæ•´èµ„æºé™åˆ¶: å‡å°‘memoryé™åˆ¶åˆ°1G
- å…³é—­ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡

#### 3. åˆå§‹åŒ–è¶…æ—¶
**ç—‡çŠ¶**: é•¿æ—¶é—´æ— æ³•è®¿é—®Webç•Œé¢
**è§£å†³**:
- æŸ¥çœ‹æ—¥å¿—: `docker compose logs -f gitlab`
- ç­‰å¾…æ›´é•¿æ—¶é—´ (é¦–æ¬¡å¯èƒ½éœ€è¦20åˆ†é’Ÿ)
- æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æ—¥å¿—
docker compose logs -f gitlab

# æœ€è¿‘æ—¥å¿—
docker compose logs --tail=100 gitlab

# ç‰¹å®šæ—¶é—´èŒƒå›´æ—¥å¿—
docker compose logs --since="2024-08-20T09:00:00" gitlab
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### èµ„æºä½¿ç”¨ç›‘æ§
```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats gitlab-v2

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
free -h
df -h
```

### å¥åº·æ£€æŸ¥
```bash
# GitLabå¥åº·æ£€æŸ¥
curl http://192.168.0.127/-/health

# å°±ç»ªçŠ¶æ€æ£€æŸ¥
curl http://192.168.0.127/-/readiness
```

## ğŸ’¾ å¤‡ä»½ç­–ç•¥

### æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®ç›®å½•
tar -czf gitlab-backup-$(date +%Y%m%d).tar.gz ~/gitlab-v2/gitlab-data/

# GitLabå†…ç½®å¤‡ä»½
docker compose exec gitlab gitlab-backup create
```

### é…ç½®å¤‡ä»½
```bash
# å¤‡ä»½docker-compose.yml
cp ~/gitlab-v2/docker-compose.yml ~/gitlab-v2/docker-compose.yml.backup
```

## ğŸ”„ æ›´æ–°å‡çº§

### æ›´æ–°GitLabç‰ˆæœ¬
```bash
cd ~/gitlab-v2

# å¤‡ä»½æ•°æ®
./manage.sh stop
tar -czf backup-before-update.tar.gz gitlab-data/

# æ‹‰å–æ–°é•œåƒ
docker compose pull

# å¯åŠ¨æ–°ç‰ˆæœ¬
docker compose up -d
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å®Œæˆ âœ…
- [x] å®¹å™¨æˆåŠŸå¯åŠ¨
- [x] ç«¯å£æ˜ å°„æ­£ç¡® (80, 2222)
- [x] æ•°æ®ç›®å½•å¤–æŒ‚é…ç½®
- [x] èµ„æºé™åˆ¶è®¾ç½® (2GBå†…å­˜)
- [x] å¥åº·æ£€æŸ¥é…ç½®
- [x] ç®¡ç†è„šæœ¬åˆ›å»º

### å¾…å®Œæˆæ“ä½œ â³
- [ ] ç­‰å¾…åˆå§‹åŒ–å®Œæˆ (10-15åˆ†é’Ÿ)
- [ ] ä¿®æ”¹é»˜è®¤å¯†ç 
- [ ] é…ç½®SSHå¯†é’¥
- [ ] åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›®
- [ ] é…ç½®å¼€æœºè‡ªå¯åŠ¨ (å¯é€‰)

### éªŒè¯é¡¹ç›® ğŸ”
- [ ] Webç•Œé¢å¯æ­£å¸¸è®¿é—®
- [ ] SSHè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¯ä»¥åˆ›å»ºå’Œå…‹éš†é¡¹ç›®
- [ ] å¤‡ä»½åŠŸèƒ½æ­£å¸¸

## ğŸ“ æ”¯æŒä¿¡æ¯

### ç®¡ç†å‘½ä»¤å¿«é€Ÿå‚è€ƒ
```bash
# åŸºæœ¬æ“ä½œ
cd ~/gitlab-v2
docker compose ps              # æŸ¥çœ‹çŠ¶æ€
docker compose logs -f gitlab  # æŸ¥çœ‹æ—¥å¿—
docker compose restart         # é‡å¯æœåŠ¡
docker compose down            # åœæ­¢æœåŠ¡

# ç®¡ç†è„šæœ¬
./manage.sh status            # çŠ¶æ€æ£€æŸ¥
./manage.sh logs              # æ—¥å¿—æŸ¥çœ‹
./manage.sh restart           # é‡å¯æœåŠ¡
```

### è®¿é—®ä¿¡æ¯æ€»ç»“
- **Web**: http://192.168.0.127 (root / GitLabAdmin2024!)
- **SSH**: git@192.168.0.127:2222
- **é¡¹ç›®ç›®å½•**: /home/ubuntu/gitlab-v2
- **æ•°æ®ç›®å½•**: /home/ubuntu/gitlab-v2/gitlab-data

---

## âœ… éƒ¨ç½²çŠ¶æ€æ€»ç»“

**ğŸ‰ GitLab v2 å·²æˆåŠŸéƒ¨ç½²åˆ° 192.168.0.127 æœåŠ¡å™¨ï¼**

**å½“å‰çŠ¶æ€**:
- âœ… å®¹å™¨è¿è¡Œæ­£å¸¸
- â³ æ­£åœ¨åˆå§‹åŒ– (é¢„è®¡10-15åˆ†é’Ÿå®Œæˆ)
- âœ… ç«¯å£æ˜ å°„æ­£ç¡®
- âœ… æ•°æ®æŒä¹…åŒ–é…ç½®
- âœ… å†…å­˜ä¼˜åŒ–è®¾ç½®

**ä¸‹ä¸€æ­¥æ“ä½œ**:
1. ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
2. è®¿é—® http://192.168.0.127 è¿›è¡Œé¦–æ¬¡ç™»å½•
3. ä¿®æ”¹é»˜è®¤å¯†ç 
4. å¼€å§‹ä½¿ç”¨GitLabï¼

---

**æ–‡æ¡£æœ€åæ›´æ–°**: 2025-08-20 17:40  
**éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ  
**é¢„è®¡å¯ç”¨æ—¶é—´**: 2025-08-20 17:55